---
title: "Presentacion"
author: "Pao"
date: "September 23, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(metR)
library(rvad)
library(data.table)
library(magrittr)
library(ggplot2)
source("helpfun.R")


# Variables útiles
mapa.ar <- setDT(fortify(rnaturalearth::ne_states(country = c("Argentina")))) %>% 
   .[, .(long = approx(.I, long, n = .N*5)$y,
         lat = approx(.I, lat, n = .N*5)$y),
     by = .(group)] %>%
   .[, range := rrange(long, lat)] %>%
   .[, azimuth := azimuth(long, lat)] %>%
   .[, group2 := cuad_split(azimuth), by = group]
```

## Campos de dBZ y Vr

```{r read}
volumen <- ReadNetCDF("data/cfrad.20181121_110832.0000_to_20181121_111113.0000_RMA4_0200_02.nc",
                      vars = c("Vda", "TH", "azimuth", "elevation")) %>% 
  setDT() %>% 
  setnames(colnames(.), c("range", "radial_wind", "time", "dBZ", "azimuth", "elevation"))
```

```{r dbz}
na.omit(volumen) %>% 
  .[elevation == unique(elevation)[1]] %>% 
  ggplot(aes(azimuth, range/1000)) +
  geom_point(aes(color = dBZ, size = range)) +
  scale_size_area(max_size = 1) +
  scale_color_gradientn(colors = viridisLite::turbo(n = 7)) +
  geom_path(data = mapa.ar,
            aes(group = interaction(group, group2)), color = "darkgray") +
  scale_x_continuous(name = NULL, labels = NULL, breaks = seq(0, 359, 90)) +
  scale_y_continuous(name = "Distancia al centro (km)",
                     breaks = c(40, 80, 120, 160, 200),
                     limits = c(0, 200), expand = c(0, 0)) +
  guides(size = "none") +
  labs(title = "RMA4 - Resistencia", 
       subtitle = "Tiempo: 2018-11-21 11:00:00 Z | Elevación 0.53 grados") + 
  coord_polar() +
  theme_minimal()+ 
  theme(panel.ontop = T, 
        legend.key.height = unit(3, "lines"),
        legend.key.width = unit(0.4, "cm"))

```

